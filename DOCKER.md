# üê≥ Docker Deployment Guide

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
ls ssl/
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å: cert.pem, key.pem, openssl.cnf
```

–ï—Å–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –Ω–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –∏—Ö:
```bash
mkdir -p ssl
cd ssl
openssl req -x509 -newkey rsa:2048 -nodes -sha256 -keyout key.pem -out cert.pem -days 365 -config openssl.cnf
cd ..
```

### –®–∞–≥ 2: –°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑—É—è npm —Å–∫—Ä–∏–ø—Ç—ã
npm run docker:build    # –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
npm run docker:up       # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ñ–æ–Ω–µ

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ù–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ docker-compose
docker-compose build
docker-compose up -d
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
npm run docker:logs
# –∏–ª–∏
docker-compose logs -f

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker ps
```

### –®–∞–≥ 4: –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
```
https://localhost:4057
https://192.168.50.57:4057
https://176.36.188.208:4057
```

## üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `npm run docker:build` | –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑ |
| `npm run docker:up` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ —Ñ–æ–Ω–µ |
| `npm run docker:down` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä |
| `npm run docker:logs` | –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ (Ctrl+C –¥–ª—è –≤—ã—Ö–æ–¥–∞) |
| `npm run docker:restart` | –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä |
| `npm run docker:rebuild` | –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å |

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä—Ç–æ–≤

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç **4057** –¥–ª—è HTTPS.

### –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç

–í —Ñ–∞–π–ª–µ `docker-compose.yml`:
```yaml
ports:
  - "4057:4057"  # –ò–∑–º–µ–Ω–∏—Ç–µ –ø–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ –Ω–∞ –Ω—É–∂–Ω—ã–π –ø–æ—Ä—Ç
```

–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø–æ—Ä—Ç–∞ 8443:
```yaml
ports:
  - "8443:4057"
```

–ó–∞—Ç–µ–º –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ:
```bash
npm run docker:rebuild
```

## üåê –î–æ—Å—Ç—É–ø –∏–∑ –≤–Ω–µ—à–Ω–µ–π —Å–µ—Ç–∏

### –ü—Ä–æ–±—Ä–æ—Å —á–µ—Ä–µ–∑ —Ä–æ—É—Ç–µ—Ä

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç **4057** –ø—Ä–æ–±—Ä–æ—à–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–æ—É—Ç–µ—Ä–∞:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–æ—É—Ç–µ—Ä–∞ (–æ–±—ã—á–Ω–æ 192.168.1.1 –∏–ª–∏ 192.168.0.1)
2. –ù–∞–π–¥–∏—Ç–µ "Port Forwarding" –∏–ª–∏ "–ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤"
3. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–æ:
   - **External Port**: 4057
   - **Internal Port**: 4057
   - **Protocol**: TCP
   - **Internal IP**: 192.168.50.57 (–≤–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π IP)

### DMZ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ DMZ (–µ—Å–ª–∏ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ):
- DMZ Host: 192.168.50.57
- –í–µ—Å—å –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –±—É–¥–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —ç—Ç–æ—Ç IP

## üîí SSL –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ
```
./ssl/
  ‚îú‚îÄ‚îÄ cert.pem    # –ü—É–±–ª–∏—á–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
  ‚îú‚îÄ‚îÄ key.pem     # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
  ‚îî‚îÄ‚îÄ openssl.cnf # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –º–æ–Ω—Ç–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ volume, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏:

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ –ø–∞–ø–∫–µ `ssl/`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
   ```bash
   npm run docker:restart
   ```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Let's Encrypt

–î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Let's Encrypt:

1. –ü–æ–ª—É—á–∏—Ç–µ –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, callme.example.com)
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Certbot:
   ```bash
   certbot certonly --standalone -d callme.example.com
   ```
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:
   ```bash
   cp /etc/letsencrypt/live/callme.example.com/fullchain.pem ssl/cert.pem
   cp /etc/letsencrypt/live/callme.example.com/privkey.pem ssl/key.pem
   ```
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
   ```bash
   npm run docker:restart
   ```

## üê≥ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –±–µ–∑ docker-compose

```bash
# –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker build -t callme:latest .

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker run -d \
  --name callme-app \
  -p 4057:4057 \
  -v $(pwd)/ssl:/app/ssl:ro \
  -e NODE_ENV=production \
  -e PORT=4057 \
  -e HOSTNAME=0.0.0.0 \
  --restart unless-stopped \
  callme:latest
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:
```env
PORT=4057
NODE_ENV=production
HOSTNAME=0.0.0.0
```

–û–±–Ω–æ–≤–∏—Ç–µ `docker-compose.yml`:
```yaml
services:
  callme:
    env_file:
      - .env
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ª–æ–≥–∞–º

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker logs callme-app --tail 100

# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker logs callme-app -f

# –° –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏
docker logs callme-app -f -t
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker ps

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats callme-app

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker inspect callme-app
```

## üîÑ CI/CD Integration

### GitHub Actions –ø—Ä–∏–º–µ—Ä

```yaml
name: Build and Deploy

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Build Docker image
        run: docker-compose build

      - name: Deploy
        run: docker-compose up -d
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check

Docker Compose –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å health check:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker inspect --format='{{.State.Health.Status}}' callme-app
```

–°—Ç–∞—Ç—É—Å—ã:
- `healthy` - –†–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- `unhealthy` - –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
- `starting` - –¢–æ–ª—å–∫–æ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è

### –ú–µ—Ç—Ä–∏–∫–∏

```bash
# CPU, –ø–∞–º—è—Ç—å, —Å–µ—Ç—å
docker stats callme-app --no-stream
```

## üõ† –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker logs callme-app

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏ —Å–±–æ—Ä–∫–∏
docker-compose build --no-cache
```

### –ü–æ—Ä—Ç —É–∂–µ –∑–∞–Ω—è—Ç

```bash
# –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 4057
# Windows:
netstat -ano | findstr :4057

# Linux/Mac:
lsof -i :4057

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose down
```

### SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
ls -la ssl/

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
cd ssl
openssl req -x509 -newkey rsa:2048 -nodes -sha256 -keyout key.pem -out cert.pem -days 365 -config openssl.cnf
cd ..

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
npm run docker:restart
```

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –∏–∑ —Å–µ—Ç–∏

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω:
   ```bash
   docker ps
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç—ã:
   ```bash
   docker port callme-app
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª:
   ```bash
   # Windows
   netsh advfirewall firewall add rule name="CallMe" dir=in action=allow protocol=TCP localport=4057
   ```

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–æ—É—Ç–µ—Ä–∞ (–ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤)

## üì¶ –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞

–¢–µ–∫—É—â–∏–π –æ–±—Ä–∞–∑ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—É—é —Å–±–æ—Ä–∫—É (multi-stage build):
- **Builder stage**: ~500MB (—Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Å–±–æ—Ä–∫–∏)
- **Runner stage**: ~200MB (—Ç–æ–ª—å–∫–æ production –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)

–§–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –±—É–¥–µ—Ç ~200MB.

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞

–û–±—Ä–∞–∑ —É–∂–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Alpine Linux (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä)
- ‚úÖ Multi-stage build
- ‚úÖ –¢–æ–ª—å–∫–æ production –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ .dockerignore –∏—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã

## üöÄ Production —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞–ª–∏–¥–Ω—ã–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** (Let's Encrypt)
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫**: `restart: unless-stopped`
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–ª–µ—Ä—Ç—ã
4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –æ–±—Ä–∞–∑
5. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–¥–µ–ª–∞–π—Ç–µ backup ssl/ –ø–∞–ø–∫–∏
6. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ Git (–¥–æ–±–∞–≤—å—Ç–µ –≤ .gitignore)

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Docker Documentation](https://docs.docker.com/)
- [Docker Compose Documentation](https://docs.docker.com/compose/)
- [Next.js Docker Documentation](https://nextjs.org/docs/deployment#docker-image)
